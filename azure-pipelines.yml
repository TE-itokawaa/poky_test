# Docker
# Build a Docker image 
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker
#
trigger: none
pr: none

schedules:
- cron: "48 03 * * *"
  displayName: Daily build
  branches:
    include:
    - master
  always: true

pool: Self Hosted Pool

variables:
  tag: '$(Build.BuildId)'
  dockerfile: '$(Build.SourcesDirectory)/Dockerfile'

stages:
- stage: Build
  displayName: Build image
  jobs:  
  - job: Build
    timeoutInMinutes: 0
    displayName: Build
    steps:
    - script: |
        echo $(pwd)
        echo ls -l > /home/itokawa/aaaaa.log
      displayName: 'Docker Build'
    
- stage: Deploy
  displayName: Deploy image
  jobs:
  - job: Deploy
    timeoutInMinutes: 0
    displayName: Deploy
    strategy:
      # default deployment strategy, more coming...
      deploy:
        steps:
        - script: cp /datadrive/poky/build/tmp/deploy/images/qemux86/core-image-minimal-qemux86-20200718051321.qemuboot.conf /home/itokawa/
